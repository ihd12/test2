<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
      xmlns:sec="http://www.thymeleaf.org/extras/spring-security">
<!-- xmlns:th => 타임리프 추가-->
<!-- xmlns:sec => 타임리프 스프링 시큐리티 추가-->
<head>
    <meta charset="UTF-8">
    <title>블로그 글 목록</title>
<!--    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.6.2/dist/css/bootstrap.min.css" integrity="sha384-xOolHFLEh07PJGoPkLv1IbcEPTNtaed2xpHsD9ESMhqIYd0nLMwNLD69Npy4HI+N" crossorigin="anonymous">-->
    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.1.3/css/bootstrap.min.css">
</head>
<body>
    <!-- th:replace="~{ 파일경로 :: fragment에 설정한 이름 }" -->
    <div id="abc" th:replace="~{ header :: fragment-header}"></div>
    <div class="container">
        <!-- isAuthenticated() : 로그인한 사용자만 보이도록 설정-->
        <!-- isAnonymous() : 로그인하지 않은 사용자만 보이도록 설정-->
        <th:block sec:authorize="isAuthenticated()">
            <button type="button" id="create-btn"
                    th:onclick="|location.href='@{/new-article}'|"
                    class="btn btn-secondary btn-sm mb-3">글 등록</button>
            <button type="button" class="btn btn-secondary btn-sm mb-3"
                    onclick="location.href='/logout'">로그아웃</button>
        </th:block>
        <button sec:authorize="isAnonymous()" type="button" class="btn btn-secondary btn-sm mb-3"
                onclick="location.href='/login'">로그인</button>
        <button sec:authorize="hasRole('ADMIN')" type="button" class="btn btn-danger">관리자만 보이는 버튼</button>
        <button sec:authorize="hasRole('USER')" type="button" class="btn btn-danger">일반 사용자만 보이는 버튼</button>
        <form action="/articles" method="get">
            <input type="hidden" name="size" th:value="${pageRequestDTO.size}"/>
            <div class="mb-3">
                <select name="types">
                    <option value="t" th:selected="${pageRequestDTO.types == 't'}">제목</option>
                    <option value="c" th:selected="${pageRequestDTO.types == 'c'}">내용</option>
                    <option value="tc" th:selected="${pageRequestDTO.types == 'tc'}">제목+내용</option>
                </select>
                <input type="text" name="keyword" th:value="${pageRequestDTO.keyword}"/>
                <input type="submit" value="검색"/>
            </div>
        </form>
        <div class="row-6" th:each="item : ${articles.dtoList}">
            <div class="card">
                <div class="card-header" th:text="${item.id}"></div>
                <div class="card-body">
                    <h5 class="card-title" th:text="${item.title}"></h5>
                    <p class="card-text" th:text="${item.content}"></p>
                    <a th:href="|@{/articles/{id}(id=${item.id})}?${pageRequestDTO.getLink()}|" class="btn btn-primary">보러가기</a>
                </div>
            </div>
            <br>
        </div>
        <div class="float-end">
            <ul class="pagination flex-wrap" th:if="${articles.totalElements>0}">
                <li th:if="${articles.prev}" class="page-item">
                    <a class="page-link" th:data-num="${articles.start -1}">이전</a>
                </li>
                <li th:each="num : ${#numbers.sequence(articles.start,articles.end)}"
                    th:class="page-item" th:classappend="${num == articles.page} ? 'active'">
                    <a class="page-link" th:data-num="${num}">[[${num}]]</a>
                </li>
                <li th:if="${articles.next}" class="page-item">
                    <a class="page-link" th:data-num="${articles.end+1}">다음</a>
                </li>
            </ul>
        </div>
    </div>
    <div th:replace="~{ header :: fragment-footer}"></div>
<script>
    document.querySelector(".pagination").addEventListener("click", (event)=>{
        event.preventDefault();
        event.stopPropagation();
        const target = event.target; // 클릭한 태그 저장
        if(target.tagName !== 'A'){
            return;
        }
        const num = target.getAttribute('data-num');
        const formObj = document.querySelector('form');
        formObj.innerHTML += `<input type='hidden' name='page' value='${num}'>`;
        formObj.submit();
    })
</script>
</body>
</html>








